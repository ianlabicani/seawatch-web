<div class="container mt-5">
  <h2 class="mb-4">User Form</h2>
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
    <div class="row g-3">
      <!-- Boat ID -->
      <div class="col-md-6">
        <label for="boatId" class="form-label">Boat*</label>
        <input
          [formControl]="formGroup.controls.boatId"
          type="text"
          class="form-control"
          id="boatId"
          name="boatId"
          placeholder="Enter Registered Boat Id"
          required
        />
      </div>

      <!-- Username -->
      <div class="col-md-6">
        <label for="username" class="form-label">Username*</label>
        <input
          [formControl]="formGroup.controls.username"
          type="text"
          class="form-control"
          id="username"
          name="username"
          placeholder="Enter username"
          required
        />
      </div>

      <!-- First Name -->
      <div class="col-md-6">
        <label for="firstname" class="form-label">First Name*</label>
        <input
          [formControl]="formGroup.controls.firstname"
          type="text"
          class="form-control"
          id="firstname"
          name="firstname"
          placeholder="Enter first name"
          required
        />
      </div>

      <!-- Last Name -->
      <div class="col-md-6">
        <label for="lastname" class="form-label">Last Name*</label>
        <input
          [formControl]="formGroup.controls.lastname"
          type="text"
          class="form-control"
          id="lastname"
          name="lastname"
          placeholder="Enter last name"
          required
        />
      </div>

      <!-- Email -->
      <div class="col-md-6">
        <label for="email" class="form-label">Email*</label>
        <input
          [formControl]="formGroup.controls.email"
          type="email"
          class="form-control"
          id="email"
          name="email"
          placeholder="Enter email"
          required
        />
      </div>

      <!-- Password -->
      <div class="col-md-6">
        <label for="password" class="form-label">Password*</label>
        <input
          [formControl]="formGroup.controls.password"
          type="password"
          class="form-control"
          id="password"
          name="password"
          placeholder="Enter Password"
          required
        />
      </div>

      <!-- Role -->
      <div class="col-md-6">
        <label for="role" class="form-label">Role*</label>
        <select
          class="form-select"
          id="role"
          name="role"
          [formControl]="formGroup.controls.role"
          [value]="formGroup.controls.role.value"
          required
        >
          <option value="admin">Admin</option>
          <option value="coast-guard">Coast Guard</option>
          <option value="user">User</option>
        </select>
      </div>

      <!-- Profile Picture URL -->
      <div class="col-md-6">
        <label for="profilePictureUrl" class="form-label"
          >Profile Picture URL</label
        >
        <input
          type="url"
          class="form-control"
          id="profilePictureUrl"
          name="profilePictureUrl"
          placeholder="Enter profile picture URL"
        />
      </div>

      <!-- Phone Number -->
      <div class="col-md-6">
        <label for="phoneNumber" class="form-label">Phone Number*</label>
        <input
          [formControl]="formGroup.controls.phoneNumber"
          type="tel"
          class="form-control"
          id="phoneNumber"
          name="phoneNumber"
          placeholder="Enter phone number"
          required
        />
      </div>

      <!-- Address -->
      <div class="col-12">
        <label for="address" class="form-label">Address</label>
        <textarea
          class="form-control"
          id="address"
          name="address"
          placeholder="Enter address"
          rows="3"
        ></textarea>
      </div>
    </div>

    <!-- Emergency Contacts -->
    <div formArrayName="emergencyContact" class="mt-4">
      <h4 class="mb-3">Emergency Contacts</h4>
      @for (contact of emergencyContact.controls; track $index) {
      <div [formGroupName]="$index" class="border rounded p-3 mb-3">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="name-{{ $index }}" class="form-label">Name</label>
            <input
              id="name-{{ $index }}"
              class="form-control"
              formControlName="name"
            />
          </div>
          <div class="col-md-4">
            <label for="relationship-{{ $index }}" class="form-label"
              >Relationship</label
            >
            <input
              id="relationship-{{ $index }}"
              class="form-control"
              formControlName="relationship"
            />
          </div>
          <div class="col-md-4">
            <label for="phoneNumber-{{ $index }}" class="form-label"
              >Phone Number</label
            >
            <input
              id="phoneNumber-{{ $index }}"
              class="form-control"
              formControlName="phoneNumber"
            />
          </div>
        </div>
        <div class="mt-3 text-end">
          <button
            type="button"
            class="btn btn-danger btn-sm"
            (click)="removeEmergencyContact($index)"
          >
            Remove Contact
          </button>
        </div>
      </div>
      }
    </div>

    <button
      class="btn btn-primary d-block mb-3"
      type="button"
      (click)="addEmergencyContact()"
    >
      Add Emergency Contact
    </button>
    @let isSubmittingData = isSubmitting();
    <!-- Submit Button -->
    <button
      type="submit"
      [disabled]="formGroup.invalid || isSubmittingData"
      class="btn btn-lg btn-primary ms-auto d-block"
    >
      @if (isSubmittingData) {
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      } @else { Submit }
    </button>
  </form>
</div>
<!-- TODO: add valiadtion messages -->
